# PROJECT CONTEXT: TELEGRAM DOCUMENTER

## RINGKASAN APLIKASI

**Nama Aplikasi:** Telegram Documenter (telegram-documenter)

**Deskripsi:** Sistem penyimpanan foto dan dokumentasi berbasis cloud yang handal dengan manajemen session terenkripsi, terintegrasi dengan Backblaze B2 cloud storage dan Google Sheets untuk logging metadata.

**Konsep Utama:** Bot Telegram yang memfasilitasi upload dan manajemen dokumentasi foto ke cloud storage dengan sistem session berbasis kode akses, role-based access control (ADMIN/USER), dan fitur metadata extraction untuk keperluan survey dan dokumentasi proyek.

**Platform:** Telegram Bot

**Status:** Versi 1.0 (Development)

---

## ARSITEKTUR SISTEM

### Komponen Utama

1. **Telegram Bot Interface**
   - Front-end interaksi dengan pengguna
   - Command-driven navigation (/start, /end, /status, /refresh, /settings, /batch)
   - Handler untuk foto/image (upload & capture)
   - Inline keyboard untuk pilihan menu
   - Role-based interface (ADMIN vs USER)

2. **Session Management System**
   - Session creation & validation
   - Access key generation & encryption
   - Session ID generation dengan format terstruktur
   - Master key authentication
   - Session state tracking

3. **Cloud Storage Integration**
   - Backblaze B2 API integration
   - File upload handler dengan progress tracking
   - Folder structure management
   - Error handling & retry mechanism

4. **Database Layer (Supabase)**
   - Session metadata storage
   - Access key management
   - User role management
   - Admin contact information
   - Upload queue & status tracking

5. **Metadata Extraction Engine**
   - EXIF data extraction dari foto
   - GPS coordinate parsing
   - Reverse geocoding untuk alamat
   - Timestamp extraction
   - Google Sheets integration via OAuth 2.0

### Alur Kerja Umum

```
User â†’ /start â†’ Role Detection â†’ Menu Selection â†’
[ADMIN Path] Create Session â†’ Generate Key â†’ Configure Session â†’ Back to Menu
[USER Path] Choose Session â†’ Input Key â†’ Validate â†’ Upload Photos â†’ /end

[Optional] Enable Log Dokumentasi â†’ OAuth Google â†’ Upload with Metadata â†’ Log to Sheet
```

---

## ROLES & PERMISSIONS

### ADMIN Role

**Capabilities:**
- âœ… Create new sessions (Create New Session)
- âœ… Access existing sessions (Choose Existing Session)
- âœ… Receive session access keys via private message
- âœ… Set session prefix
- âœ… View all access keys via database
- âœ… Use master key to access any session
- âœ… All USER capabilities

**Restrictions:**
- None - full access to all features

**Identification:**
- Phone number registered in bot database
- Pre-configured during bot setup

### USER Role

**Capabilities:**
- âœ… Access existing sessions with valid key
- âœ… Upload photos to session
- âœ… Take photos directly via Telegram
- âœ… Check upload status (/status)
- âœ… End session (/end)
- âœ… Refresh system (/refresh)
- âœ… Enable/disable Log Dokumentasi mode
- âœ… Use batch mode for multiple photos

**Restrictions:**
- âŒ Cannot create new sessions
- âŒ Cannot view access keys
- âŒ Cannot access sessions without valid key
- âŒ Cannot use master key

**Identification:**
- Any Telegram user not in ADMIN list
- Role determined at /start

---

## SESSION MANAGEMENT SYSTEM

### Session ID Format

**Structure:**
```
[PREFIX]-[MMDD]-[NN]-[Description]
```

**Components:**

1. **PREFIX (2-3 characters)**
   - Set by ADMIN during session creation
   - Examples: "ID", "DCM", "SRV"
   - Case-insensitive
   - Alphanumeric only

2. **MMDD (4 digits)**
   - Auto-generated by system
   - Format: Month (2 digits) + Date (2 digits)
   - Based on session creation date
   - Example: "0914" = September 14

3. **NN (2 digits)**
   - Auto-generated sort number
   - Sequential number for sessions created on same date
   - Starts from "01"
   - Increments automatically
   - Example: "01", "02", "03"

4. **Description (free text)**
   - Input by ADMIN during creation
   - Human-readable session purpose
   - Can contain spaces and special characters
   - Recommended max: 50 characters

**Complete Examples:**
```
DCM-0914-02-Liburan ke Surabaya
ID-1225-01-Project Christmas Event
SRV-0101-03-New Year Survey
```

### Session Access Key

**Generation Process:**

1. **Key Format:**
   ```
   ABC:DEF:GHI
   ```
   - 9 characters total (3 groups of 3)
   - Separated by colons
   - Alphanumeric characters
   - Case-sensitive
   - Cryptographically random

2. **Key Generation Trigger:**
   - Automatically generated when ADMIN creates new session
   - Sent privately to ADMIN's Telegram
   - Stored encrypted in Supabase database
   - Used to encrypt session access

3. **Key Distribution:**
   - ADMIN receives key via bot private message
   - ADMIN manually shares key with authorized users
   - Key remains valid until session is deleted
   - No expiration by default

### Master Key

**Specifications:**
- **Format:** 12 alphanumeric characters
- **Purpose:** Emergency access to any session
- **Holder:** ADMIN only
- **Usage:** Override for any session access key
- **Storage:** Encrypted in database + ADMIN secure storage
- **Security:** Should be rotated periodically

**Usage Scenario:**
```
User: Enter Session ID: DCM-0914-02
Bot: Enter access key:
User: [MASTER_KEY_12_CHARS]
Bot: âœ… Master key accepted. Session access granted.
```

---

## FITUR VERSI 1.0

### 1. SESSION CREATION (ADMIN ONLY)

**Nama Menu:** ğŸ†• Create New Session

**Tujuan:** Membuat session baru dengan konfigurasi custom dan access key yang aman.

#### Alur Interaksi Detail

**LANGKAH 1: Inisiasi**
- ADMIN mengklik tombol "ğŸ†• Create New Session"
- Bot memvalidasi role ADMIN

**Pesan Bot:**
```
ğŸ” Creating New Session

Generating secure access key...
```

**LANGKAH 2: Key Generation**
- Bot generate 9-character random key (ABC:DEF:GHI)
- Bot menyimpan key ke Supabase (encrypted)
- Bot mengirim key ke ADMIN

**Pesan Bot:**
```
âœ… Access Key Generated!

ğŸ”‘ Your session key: ABC:DEF:GHI

âš ï¸ IMPORTANT:
â€¢ Save this key securely
â€¢ Share only with authorized users
â€¢ Key cannot be recovered if lost

This key will be used to access the session.
```

**LANGKAH 3: Prefix Input**
- Bot meminta ADMIN input prefix

**Pesan Bot:**
```
Please enter session PREFIX (2-3 characters):

Examples: ID, DCM, SRV

This will be part of your session ID.
```

**ADMIN Input:**
```
DCM
```

**LANGKAH 4: Konfirmasi ID Preview**
- Bot auto-generate MMDD dan NN
- Bot menampilkan preview Session ID

**Pesan Bot:**
```
ğŸ“‹ Session ID Preview:

DCM-0914-02

â€¢ Prefix: DCM
â€¢ Date: September 14, 2024
â€¢ Sequence: 02 (2nd session today)

Ready to continue?
```

**Inline Buttons:**
- âœ… Continue
- âŒ Cancel

**LANGKAH 5: Description Input**
- ADMIN klik "âœ… Continue"
- Bot meminta deskripsi

**Pesan Bot:**
```
Enter session description:

This will help identify the session purpose.
Example: "Project site survey - East Java"
```

**ADMIN Input:**
```
Liburan ke Surabaya
```

**LANGKAH 6: Final Confirmation**
- Bot menampilkan ringkasan lengkap

**Pesan Bot:**
```
âœ… Session Created Successfully!

ğŸ“ Session Details:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Œ ID: DCM-0914-02-Liburan ke Surabaya
ğŸ”‘ Key: ABC:DEF:GHI
ğŸ“… Created: September 14, 2024 14:32
ğŸ‘¤ Creator: @admin_username
â˜ï¸ Storage: Backblaze B2 bucket initialized
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Session is ready for use.
Share the key with authorized users.
```

**LANGKAH 7: Return to Menu**
- Bot kembali ke main menu
- Session tersimpan di database
- Folder dibuat di Backblaze B2

---

### 2. SESSION ACCESS (USER & ADMIN)

**Nama Menu:** ğŸ“‚ Choose Existing Session

**Tujuan:** Mengakses session yang sudah ada untuk upload dokumentasi.

#### Alur Interaksi Detail

**LANGKAH 1: Inisiasi**
- User mengklik "ğŸ“‚ Choose Existing Session"
- Bot meminta Session ID

**Pesan Bot:**
```
Enter Session ID:

Format: PREFIX-MMDD-NN
Example: DCM-0914-02

Or send full ID with description.
```

**LANGKAH 2: Session ID Validation**
- User input Session ID

**User Input:**
```
DCM-0914-02
```

**Bot Processing:**
- Check if session exists in database
- Validate format
- Retrieve session metadata

**If Session Exists:**
```
ğŸ“‚ Session Found!

Session: DCM-0914-02-Liburan ke Surabaya
Created: September 14, 2024

Please enter access key:
```

**If Session Not Found:**
```
âŒ Session not found

Session ID "DCM-0914-02" doesn't exist.

Please check:
â€¢ Spelling and format
â€¢ Session may have been deleted
â€¢ Contact admin for valid sessions
```

**LANGKAH 3: Access Key Input**
- User input access key

**User Input:**
```
ABC:DEF:GHI
```

**Bot Processing:**
- Decrypt stored key from database
- Compare with user input
- Validate match

**If Key Correct:**
```
âœ… Access Granted!

Session: DCM-0914-02-Liburan ke Surabaya
Status: Active
Files: 0 uploaded

You can now upload photos.
ğŸ“¸ Send photos or use camera
â„¹ï¸ Use /status to check progress
ğŸ›‘ Use /end when finished
```

**If Key Incorrect:**
```
âŒ Invalid Access Key

The key you entered is incorrect.

Remaining attempts: 2

Please try again or contact the session admin.
```

**After 3 Failed Attempts:**
```
ğŸ”’ Session Locked

Too many failed attempts.
This session is locked for 15 minutes.

Please contact admin for assistance.
```

**LANGKAH 4: Master Key Override (ADMIN)**
- If ADMIN uses master key

**Admin Input:**
```
[MASTER_KEY_12_CHARS]
```

**Bot Response:**
```
ğŸ”“ Master Key Accepted

Admin override activated.
Full session access granted.

Session: DCM-0914-02-Liburan ke Surabaya
```

---

### 3. PHOTO UPLOAD & DOCUMENTATION

**Tujuan:** Upload foto ke cloud storage dalam session yang aktif.

#### Upload Methods

**Method 1: Direct Upload**
- User sends photo from gallery
- Bot receives photo
- Bot uploads to Backblaze B2
- Bot confirms upload

**Method 2: Telegram Camera**
- User uses Telegram camera feature
- Takes photo directly
- Bot receives photo
- Bot uploads to Backblaze B2
- Bot confirms upload

#### Alur Interaksi Detail

**LANGKAH 1: User Sends Photo**
- User dalam session aktif
- User sends photo

**Pesan Bot (Immediate):**
```
ğŸ“¤ Uploading...

File: IMG_20240914_143022.jpg
Size: 2.4 MB
```

**LANGKAH 2: Upload Process**
- Bot downloads photo from Telegram servers
- Bot uploads to Backblaze B2
- Bot tracks progress

**Progress Indicator:**
```
ğŸ“¤ Uploading... 45%

â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
```

**LANGKAH 3: Success Confirmation**

**Pesan Bot:**
```
âœ… Upload Successful!

ğŸ“ DCM-0914-02-Liburan ke Surabaya
ğŸ“¸ IMG_20240914_143022.jpg
ğŸ’¾ Size: 2.4 MB
â˜ï¸ Stored in: /DCM-0914-02/
ğŸ”— File #1

Current session: 1 file uploaded

Send more photos or use /end to finish.
```

**LANGKAH 4: Multiple Uploads**
- User dapat terus upload
- Bot tracks setiap file
- Counter increment otomatis

**Pesan Bot (After 5 uploads):**
```
âœ… Upload Successful!

ğŸ“¸ IMG_20240914_143527.jpg
ğŸ”— File #5

Current session: 5 files uploaded

ğŸ“Š Session Statistics:
â€¢ Total files: 5
â€¢ Total size: 12.3 MB
â€¢ Upload success rate: 100%
```

---

### 4. UPLOAD STATUS TRACKING

**Command:** /status

**Tujuan:** Melihat progress upload dan status session aktif.

#### Alur Interaksi Detail

**LANGKAH 1: User Executes Command**

**User Input:**
```
/status
```

**LANGKAH 2: Bot Displays Status**

**Scenario A: Upload in Progress**
```
ğŸ“Š Upload Status

Session: DCM-0914-02-Liburan ke Surabaya

Progress: 7 dari 10 files uploaded

ğŸ“¤ Uploading:
â€¢ IMG_20240914_144201.jpg (67%)
â€¢ IMG_20240914_144205.jpg (23%)

âœ… Completed: 7 files
â³ In Queue: 1 file
ğŸ“¦ Total Size: 18.2 MB

Estimated time remaining: 45 seconds
```

**Scenario B: All Uploads Complete**
```
âœ… All Uploads Complete!

Session: DCM-0914-02-Liburan ke Surabaya

Statistics:
â€¢ Total files: 10
â€¢ Success: 10
â€¢ Failed: 0
â€¢ Total size: 24.5 MB
â€¢ Duration: 3m 24s

All files safely stored in cloud.
Use /end to close session.
```

**Scenario C: Upload with Errors**
```
âš ï¸ Upload Status - Errors Detected

Session: DCM-0914-02-Liburan ke Surabaya

Progress: 8 dari 10 files uploaded

âœ… Successful: 8 files
âŒ Failed: 2 files

Failed Files:
1. IMG_20240914_144512.jpg
   Error: 503 Bad Gateway
   
2. IMG_20240914_144520.jpg
   Error: Connection timeout

Options:
â€¢ Use /refresh to retry failed uploads
â€¢ Use /end to finish (failed files will be listed)
```

**Scenario D: No Active Session**
```
â„¹ï¸ No Active Session

You are not currently in any session.

Use /start to:
â€¢ Create new session (Admin)
â€¢ Choose existing session
```

---

### 5. SESSION TERMINATION

**Command:** /end

**Tujuan:** Mengakhiri session aktif dan memberikan ringkasan.

#### Alur Interaksi Detail

**LANGKAH 1: User Executes Command**

**User Input:**
```
/end
```

**LANGKAH 2: Bot Checks Status**

**Scenario A: All Uploads Successful**

**Pesan Bot:**
```
âœ… Session Ended Successfully

Session: DCM-0914-02-Liburan ke Surabaya

ğŸ“Š Final Report:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¸ Total Photos: 10
âœ… Successful: 10
âŒ Failed: 0
ğŸ’¾ Total Size: 24.5 MB
â±ï¸ Duration: 5m 32s
ğŸ“… Date: September 14, 2024 14:38
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

All files are safely stored in cloud.

Thank you for using Telegram Documenter!
```

**Scenario B: With Failed Uploads**

**Pesan Bot:**
```
âš ï¸ Session Ended with Errors

Session: DCM-0914-02-Liburan ke Surabaya

ğŸ“Š Final Report:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¸ Total Photos: 10
âœ… Successful: 8
âŒ Failed: 2
ğŸ’¾ Total Size: 19.8 MB
â±ï¸ Duration: 5m 32s
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ Failed Uploads:
1. IMG_20240914_144512.jpg
   â†’ Error: 503 Bad Gateway
   
2. IMG_20240914_144520.jpg
   â†’ Error: Connection timeout

âš ï¸ These files were NOT uploaded.
Please save them and try again in a new session.

Would you like to retry failed uploads now?
```

**Inline Buttons:**
- ğŸ”„ Retry Failed Uploads
- âŒ End Without Retry

**If User Clicks "Retry Failed Uploads":**
- Bot automatically retries upload
- Shows progress
- Updates final report

**If User Clicks "End Without Retry":**
```
Session closed.

Failed files list saved.
Contact admin if you need assistance.
```

**Scenario C: Upload in Progress**

**Pesan Bot:**
```
âš ï¸ Warning: Uploads in Progress

You have 3 files still uploading:
â€¢ IMG_20240914_144512.jpg (45%)
â€¢ IMG_20240914_144520.jpg (78%)
â€¢ IMG_20240914_144525.jpg (12%)

Force end session?

âš ï¸ Files may not be fully uploaded.
```

**Inline Buttons:**
- â›” Force End (Stop Uploads)
- â†©ï¸ Cancel (Continue Session)

**If Force End:**
```
ğŸ›‘ Session Force Stopped

Session: DCM-0914-02-Liburan ke Surabaya

Incomplete uploads:
â€¢ IMG_20240914_144512.jpg (partial)
â€¢ IMG_20240914_144520.jpg (partial)
â€¢ IMG_20240914_144525.jpg (partial)

These files were NOT fully uploaded.
```

**LANGKAH 3: Session Cleanup**
- Bot closes session
- Clears session state
- Updates database
- User returns to main menu

---

### 6. SYSTEM REFRESH

**Command:** /refresh

**Tujuan:** Refresh sistem saat terjadi error atau gangguan.

#### Alur Interaksi Detail

**LANGKAH 1: User Executes Command**

**User Input:**
```
/refresh
```

**LANGKAH 2: Bot Performs Refresh**

**Pesan Bot:**
```
ğŸ”„ Refreshing System...

â€¢ Checking connection to Backblaze B2...
â€¢ Validating session state...
â€¢ Clearing error logs...
â€¢ Resetting upload queue...
```

**LANGKAH 3: Refresh Complete**

**Scenario A: Refresh Successful**
```
âœ… System Refreshed

All systems operational:
âœ… Telegram connection: OK
âœ… Backblaze B2: Connected
âœ… Database: Online
âœ… Session state: Validated

You can continue uploading.
```

**Scenario B: Issues Found**
```
âš ï¸ Refresh Complete - Issues Detected

System Status:
âœ… Telegram connection: OK
âœ… Database: Online
âŒ Backblaze B2: Connection error

Current session may not accept uploads.

Recommended actions:
â€¢ Wait 2-3 minutes and /refresh again
â€¢ Contact admin if issue persists
â€¢ Save your photos locally
```

**LANGKAH 4: Auto-Retry Failed Uploads**
- If refresh successful
- Bot automatically retries any failed uploads

**Pesan Bot:**
```
ğŸ”„ Retrying failed uploads...

â€¢ IMG_20240914_144512.jpg... âœ… Success!
â€¢ IMG_20240914_144520.jpg... âœ… Success!

All previously failed uploads now complete.
```

---

### 7. LOG DOKUMENTASI MODE (ADVANCED FEATURE)

**Aktivasi:** Via /settings menu

**Tujuan:** Mengekstrak dan menyimpan metadata foto ke Google Sheets untuk keperluan survey dan dokumentasi proyek.

#### Prerequisites

**Requirements:**
- User harus berada dalam session aktif
- Google account untuk OAuth 2.0
- Google Drive access granted

#### Alur Interaksi Detail

**LANGKAH 1: Mengakses Settings**

**User Input:**
```
/settings
```

**Pesan Bot:**
```
âš™ï¸ Settings Menu

Current Session: DCM-0914-02-Liburan ke Surabaya

Features:
```

**Inline Buttons:**
- ğŸ“Š Log Dokumentasi (OFF)
- ğŸ“¸ Auto-compress (ON)
- ğŸ”” Notifications (ON)
- â†©ï¸ Back to Main Menu

**LANGKAH 2: Aktivasi Log Dokumentasi**

**User Clicks:** ğŸ“Š Log Dokumentasi (OFF)

**Check 1: Session Status**

**If NOT in Session:**
```
âš ï¸ Session Required

Log Dokumentasi requires an active session.

Please:
1. Exit settings (/start)
2. Choose or create a session
3. Return to /settings to enable this feature
```

**If IN Session:**
```
ğŸ“Š Log Dokumentasi

This feature extracts metadata from your photos and logs them to Google Sheets.

Metadata extracted:
ğŸ“… Date taken
ğŸ• Time taken
ğŸ“¸ Photo name
ğŸ“ GPS coordinates
ğŸ—ºï¸ Address (reverse geocoded)
âœï¸ Your description
ğŸ”— Cloud storage link

âš ï¸ Important:
â€¢ Send photos as DOCUMENTS (not compressed)
â€¢ This preserves GPS metadata
â€¢ Required for survey documentation

Enable Log Dokumentasi?
```

**Inline Buttons:**
- âœ… Enable
- âŒ Cancel

**LANGKAH 3: Google OAuth Authentication**

**User Clicks:** âœ… Enable

**Pesan Bot:**
```
ğŸ” Google Authentication Required

To save logs to your Google Drive, please authenticate:

1. Click the link below
2. Sign in with your Google account
3. Grant access to Google Sheets
4. Return here when complete

ğŸ”— [Authenticate with Google]
(OAuth 2.0 secure link)

Waiting for authentication...
```

**After Successful OAuth:**
```
âœ… Google Account Connected!

Account: user@gmail.com
Access granted to:
â€¢ Google Sheets (Create & Edit)
â€¢ Google Drive (File storage)

Creating log sheet...
```

**LANGKAH 4: Sheet Creation**

**Pesan Bot:**
```
âœ… Log Sheet Created!

ğŸ“„ Sheet: "DCM-0914-02 - Documentation Log"
ğŸ“ Location: Google Drive / Telegram Documenter
ğŸ”— [Open Google Sheet]

Log Dokumentasi is now ACTIVE.

When you send photos:
1. Photo will be uploaded to cloud
2. You'll be asked for description
3. Metadata will be logged to sheet

Ready to start!
```

**LANGKAH 5: Upload Photo with Metadata**

**User Sends Photo (as Document)**

**Pesan Bot:**
```
ğŸ“¸ Photo Received

Extracting metadata...

ğŸ“Š Metadata Found:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… Date: September 14, 2024
ğŸ• Time: 14:45:22
ğŸ“ GPS: -7.2575, 112.7521
ğŸ—ºï¸ Location: Jl. Raya Darmo, Surabaya, East Java
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Please enter photo description:

Example: "Front view of building entrance"
```

**User Input:**
```
Gerbang utama kompleks
```

**Pesan Bot:**
```
âœ… Description saved

Uploading to cloud...
```

**After Upload:**
```
âœ… Photo Logged Successfully!

ğŸ“¸ IMG_20240914_144522.jpg
ğŸ“Š Metadata logged to Google Sheets
â˜ï¸ File uploaded to cloud

Continue sending photos or use /end when finished.
```

**LANGKAH 6: Batch Mode**

**Purpose:** Upload multiple photos, then add description to all at once

**User Input:**
```
/batch
```

**Pesan Bot:**
```
ğŸ“¦ Batch Mode Activated

Send multiple photos now.
Description will be asked after batch ends.

When finished sending photos, use:
/endbatch
```

**User Sends 5 Photos**

**Pesan Bot (After Each):**
```
ğŸ“¸ Photo added to batch (1/?)
ğŸ“¸ Photo added to batch (2/?)
ğŸ“¸ Photo added to batch (3/?)
ğŸ“¸ Photo added to batch (4/?)
ğŸ“¸ Photo added to batch (5/?)

Use /endbatch to finish and add description.
```

**User Input:**
```
/endbatch
```

**Pesan Bot:**
```
ğŸ“¦ Batch Upload Complete

Photos in batch: 5

Extracting metadata from all photos...

âœ… Metadata extracted:
â€¢ All photos have GPS data
â€¢ All photos taken on: Sep 14, 2024
â€¢ Time range: 14:45 - 14:52
â€¢ Location: Surabaya area

Enter description for ALL photos in this batch:
```

**User Input:**
```
Dokumentasi area parkir dan sekitarnya
```

**Pesan Bot:**
```
âœ… Batch Processing...

Uploading and logging 5 photos...

1/5 âœ… IMG_20240914_144522.jpg
2/5 âœ… IMG_20240914_144530.jpg
3/5 âœ… IMG_20240914_144545.jpg
4/5 âœ… IMG_20240914_144558.jpg
5/5 âœ… IMG_20240914_145201.jpg

âœ… All 5 photos uploaded and logged!

Same description applied to all photos.
Check your Google Sheet for details.
```

---

### 8. GOOGLE SHEETS LOGGING STRUCTURE

**Sheet Name:** `[SESSION-ID] - Documentation Log`

**Sheet Structure:**

| Column | Header | Data Type | Example |
|--------|--------|-----------|---------|
| A | No. | Auto Number | 1 |
| B | Tanggal Pengambilan | Date | 2024-09-14 |
| C | Waktu Pengambilan | Time | 14:45:22 |
| D | Nama Foto | Text | IMG_20240914_144522.jpg |
| E | Latitude | Number | -7.2575 |
| F | Longitude | Number | 112.7521 |
| G | Koordinat | Text | -7.2575, 112.7521 |
| H | Alamat | Text | Jl. Raya Darmo, Surabaya |
| I | Deskripsi | Text | Gerbang utama kompleks |
| J | Link Cloud | URL | https://b2.backblaze.com/... |
| K | Upload Time | Timestamp | 2024-09-14 14:46:05 |
| L | Uploaded By | Text | @username |

**Sheet Formatting:**
- Header row: Bold, background color #4285F4 (Google Blue)
- Freeze first row
- Auto-resize columns
- URL column as clickable links
- Conditional formatting for empty GPS data (yellow highlight)

**Sample Data:**
```
1 | 2024-09-14 | 14:45:22 | IMG_20240914_144522.jpg | -7.2575 | 112.7521 | -7.2575, 112.7521 | Jl. Raya Darmo, Surabaya | Gerbang utama | https://... | 2024-09-14 14:46:05 | @johndoe
2 | 2024-09-14 | 14:45:30 | IMG_20240914_144530.jpg | -7.2575 | 112.7521 | -7.2575, 112.7521 | Jl. Raya Darmo, Surabaya | Dokumentasi parkir | https://... | 2024-09-14 14:46:12 | @johndoe
```

---

## SPESIFIKASI TEKNIS

### Input Requirements

1. **Session ID Format**
   - PREFIX: 2-3 alphanumeric characters
   - MMDD: Auto-generated, 4 digits
   - NN: Auto-generated, 2 digits (01-99)
   - Description: Max 100 characters
   - Total format: `PREFIX-MMDD-NN-Description`

2. **Access Key Format**
   - 9 characters: ABC:DEF:GHI
   - Alphanumeric: A-Z, a-z, 0-9
   - Colon separators at positions 3 and 6
   - Case-sensitive
   - Cryptographically random

3. **Master Key Format**
   - 12 alphanumeric characters
   - Case-sensitive
   - No separators
   - Highly secure generation required

4. **Photo Requirements**
   - Accepted formats: JPG, JPEG, PNG
   - Max file size: 20 MB per photo
   - For metadata extraction: Send as DOCUMENT (not compressed)
   - EXIF data must be present for GPS extraction

### Cloud Storage Integration (Backblaze B2)

**API Requirements:**
- Backblaze B2 API credentials
- Bucket creation and management
- File upload with progress tracking
- Error handling and retry logic

**Folder Structure in B2:**
```
bucket-name/
â”œâ”€â”€ DCM-0914-01-Project-Alpha/
â”‚   â”œâ”€â”€ IMG_20240914_143022.jpg
â”‚   â”œâ”€â”€ IMG_20240914_143105.jpg
â”‚   â””â”€â”€ ...
â”œâ”€â”€ DCM-0914-02-Liburan-ke-Surabaya/
â”‚   â”œâ”€â”€ IMG_20240914_144522.jpg
â”‚   â””â”€â”€ ...
â””â”€â”€ ID-0915-01-Client-Meeting/
    â””â”€â”€ ...
```

**File Naming in Cloud:**
- Keep original filename
- Add prefix if duplicate: `filename_1.jpg`, `filename_2.jpg`
- Maintain file extension

**Upload Process:**
1. Get upload URL from B2
2. Get upload authorization
3. Upload file with SHA-1 hash
4. Verify upload completion
5. Store file ID and URL in database

### Database Schema (Supabase)

**Table: sessions**
```sql
CREATE TABLE sessions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  session_id VARCHAR(200) UNIQUE NOT NULL,
  prefix VARCHAR(3) NOT NULL,
  date_code VARCHAR(4) NOT NULL,
  sequence_number VARCHAR(2) NOT NULL,
  description VARCHAR(200),
  access_key_encrypted TEXT NOT NULL,
  created_by VARCHAR(100) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  status VARCHAR(20) DEFAULT 'active',
  b2_folder_path TEXT,
  total_files INTEGER DEFAULT 0,
  total_size_mb DECIMAL DEFAULT 0
);
```

**Table: admins**
```sql
CREATE TABLE admins (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  telegram_user_id BIGINT UNIQUE NOT NULL,
  username VARCHAR(100),
  phone_number VARCHAR(20),
  added_at TIMESTAMP DEFAULT NOW(),
  master_key_encrypted TEXT NOT NULL
);
```

**Table: uploads**
```sql
CREATE TABLE uploads (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  session_id UUID REFERENCES sessions(id),
  filename VARCHAR(255) NOT NULL,
  file_size_mb DECIMAL,
  b2_file_id TEXT,
  b2_file_url TEXT,
  upload_status VARCHAR(20) DEFAULT 'pending',
  uploaded_by VARCHAR(100),
  uploaded_at TIMESTAMP DEFAULT NOW(),
  error_log TEXT,
  metadata_json JSONB
);
```

**Table: metadata_logs**
```sql
CREATE TABLE metadata_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  upload_id UUID REFERENCES uploads(id),
  session_id UUID REFERENCES sessions(id),
  photo_name VARCHAR(255),
  date_taken DATE,
  time_taken TIME,
  latitude DECIMAL(10, 7),
  longitude DECIMAL(10, 7),
  address TEXT,
  user_description TEXT,
  cloud_link TEXT,
  google_sheet_row INTEGER,
  created_at TIMESTAMP DEFAULT NOW()
);
```

**Table: google_auth**
```sql
CREATE TABLE google_auth (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  telegram_user_id BIGINT UNIQUE NOT NULL,
  google_email VARCHAR(200),
  access_token_encrypted TEXT,
  refresh_token_encrypted TEXT,
  token_expiry TIMESTAMP,
  sheet_id TEXT,
  authorized_at TIMESTAMP DEFAULT NOW()
);
```

### Metadata Extraction

**EXIF Data Fields:**
- `DateTimeOriginal`: Tanggal dan waktu pengambilan foto
- `GPSLatitude`: Koordinat latitude
- `GPSLongitude`: Koordinat longitude
- `GPSLatitudeRef`: Referensi N/S
- `GPSLongitudeRef`: Referensi E/W
- `Make`: Merek kamera/HP
- `Model`: Model device

**GPS Coordinate Processing:**
1. Extract from EXIF
2. Convert to decimal degrees
3. Validate range (lat: -90 to 90, lon: -180 to 180)
4. Format: `-7.2575, 112.7521`

**Reverse Geocoding:**
- API: Google Maps Geocoding API atau OpenStreetMap Nominatim
- Input: Latitude, Longitude
- Output: Formatted address
- Fallback: "Coordinates only" jika API gagal

**Metadata Extraction Libraries:**
- Python: `Pillow` (PIL) with `exifread` or `piexif`
- Node.js: `exif-parser` or `exifr`
- Error handling untuk foto tanpa EXIF

### Google Sheets Integration

**OAuth 2.0 Flow:**
1. User clicks "Enable Log Dokumentasi"
2. Bot generates OAuth URL
3. User authenticates via browser
4. Google redirects with auth code
5. Bot exchanges code for tokens
6. Tokens stored encrypted in database

**Sheet API Operations:**
- Create new spreadsheet
- Add headers
- Append rows
- Format cells
- Share sheet with user
- Get sheet URL

**Data Writing:**
- Batch write for performance
- Retry on failure
- Validate data before write
- Handle API rate limits

### Error Handling

**Error Categories:**

1. **Upload Errors**
   - Network timeout
   - Server errors (5xx)
   - File too large
   - Invalid file format
   - B2 authentication failure

2. **Session Errors**
   - Invalid session ID
   - Session not found
   - Access denied
   - Session locked
   - Concurrent access conflict

3. **Metadata Errors**
   - No EXIF data found
   - GPS data missing
   - Invalid coordinates
   - Geocoding API failure

4. **Google Integration Errors**
   - OAuth failure
   - Token expired
   - Sheet creation error
   - API quota exceeded
   - Permission denied

**Error Response Format:**
```
âŒ [Error Title]

Details: [Specific error message]

Possible causes:
â€¢ [Cause 1]
â€¢ [Cause 2]

Suggested actions:
â€¢ [Action 1]
â€¢ [Action 2]

Error code: [ERROR_CODE]
```

**Retry Logic:**
- Automatic retry: 3 attempts with exponential backoff
- User-initiated retry: Via /refresh command
- Persistent failures: Log to database and notify admin

---

## DATA FLOW

### 1. Session Creation Flow

```
ADMIN clicks Create New Session
    â†“
Bot validates ADMIN role
    â†“
Generate random access key (ABC:DEF:GHI)
    â†“
Encrypt and store key in Supabase
    â†“
Send key to ADMIN via private message
    â†“
Request PREFIX input from ADMIN
    â†“
ADMIN inputs PREFIX
    â†“
Bot generates MMDD from current date
    â†“
Bot queries database for sequence number (NN)
    â†“
Bot displays preview: PREFIX-MMDD-NN
    â†“
ADMIN confirms
    â†“
Request description input
    â†“
ADMIN inputs description
    â†“
Create session record in database
    â†“
Create folder in Backblaze B2
    â†“
Display success message with full session details
    â†“
Return to main menu
```

### 2. Session Access Flow

```
USER clicks Choose Existing Session
    â†“
Bot requests Session ID
    â†“
USER inputs Session ID
    â†“
Bot validates format
    â†“
Bot queries database for session
    â†“
[If Not Found] â†’ Error message â†’ Return to menu
[If Found] â†’ Continue
    â†“
Bot requests access key
    â†“
USER inputs key
    â†“
Bot decrypts stored key from database
    â†“
Bot compares keys
    â†“
[If Mismatch] â†’ Failed attempt counter++ â†’ Allow retry
[If 3 Failures] â†’ Lock session for 15 minutes
[If Match] â†’ Continue
    â†“
Grant session access
    â†“
Initialize upload session
    â†“
Display session info and ready message
```

### 3. Photo Upload Flow

```
USER in active session
    â†“
USER sends photo
    â†“
Bot receives photo from Telegram
    â†“
Bot downloads photo to temporary storage
    â†“
[If Log Mode Active]
    â†“
    Extract EXIF metadata
        â†“
    [If GPS data present]
        â†“
        Reverse geocode coordinates to address
        â†“
        Request description from user
        â†“
        USER inputs description
        â†“
        Continue to upload
    [If No GPS data]
        â†“
        Notify user (warning)
        â†“
        Request description from user
        â†“
        Continue to upload
        
[Regular Upload]
    â†“
Get B2 upload URL and auth token
    â†“
Calculate file hash (SHA-1)
    â†“
Upload file to B2 with progress tracking
    â†“
[If Upload Success]
    â†“
    Store file metadata in database
    â†“
    [If Log Mode]
        â†“
        Write metadata to Google Sheets
    â†“
    Send success confirmation to user
    â†“
    Update session statistics
    
[If Upload Error]
    â†“
    Log error to database
    â†“
    Retry (up to 3 times)
    â†“
    [If Still Failed]
        â†“
        Notify user with error details
        â†“
        Add to failed uploads list
```

### 4. Batch Upload Flow

```
USER in active session
    â†“
USER executes /batch
    â†“
Bot enters batch mode
    â†“
Bot creates temporary batch array
    â†“
USER sends multiple photos
    â†“
For each photo:
    â†“
    Download to temporary storage
    â†“
    Add to batch array
    â†“
    Send acknowledgment (count)
    â†“
USER executes /endbatch
    â†“
Bot extracts metadata from all photos in batch
    â†“
Bot displays metadata summary
    â†“
Bot requests description for entire batch
    â†“
USER inputs description
    â†“
Bot processes each photo in batch:
    â†“
    Upload to B2
    â†“
    Apply same description
    â†“
    [If Log Mode] Write to Google Sheets
    â†“
    Update progress indicator
    â†“
Bot sends completion summary
    â†“
Clear batch array
    â†“
Return to normal mode
```

---

## USER INTERFACE DESIGN

### Main Menu Structure

**Initial Menu (/start):**

```
ğŸ  Telegram Documenter

Welcome, [Username]!
Role: [ADMIN/USER]

Choose an option:
```

**For ADMIN:**
```
ğŸ†• Create New Session
ğŸ“‚ Choose Existing Session
âš™ï¸ Settings
â“ Help
```

**For USER:**
```
ğŸ“‚ Choose Existing Session
âš™ï¸ Settings
â“ Help
```

### In-Session Interface

**Session Active Banner:**
```
âœ… Active Session
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ DCM-0914-02-Liburan ke Surabaya
ğŸ“Š Files: 5 uploaded
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**Available Commands During Session:**
```
Commands:
/status - Check upload progress
/end - End session
/refresh - Refresh system
/settings - Session settings
/batch - Start batch upload
```

### Settings Menu

```
âš™ï¸ Settings

Session: DCM-0914-02-Liburan ke Surabaya
```

**Settings Options:**
```
ğŸ“Š Log Dokumentasi: [ON/OFF]
   Extract and log photo metadata

ğŸ“¸ Auto-compress: [ON/OFF]
   Compress photos before upload

ğŸ”” Notifications: [ON/OFF]
   Upload completion alerts

ğŸ—‚ï¸ File naming: [ORIGINAL/TIMESTAMP]
   How to name uploaded files

â†©ï¸ Back to Session
```

### Progress Indicators

**Upload Progress:**
```
ğŸ“¤ Uploading...

â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50%

IMG_20240914_144522.jpg
2.4 MB / 4.8 MB

Estimated: 12 seconds
```

**Batch Progress:**
```
ğŸ“¦ Batch Upload Progress

â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 3/5

âœ… IMG_001.jpg
âœ… IMG_002.jpg
âœ… IMG_003.jpg
â³ IMG_004.jpg (uploading...)
â¹ï¸ IMG_005.jpg (pending)
```

**Multiple Operations:**
```
ğŸ”„ Processing...

âœ… Extracting metadata... Done
âœ… Uploading to cloud... Done
â³ Writing to Google Sheets... 
â¹ï¸ Sending confirmation...
```

### Button Layouts

**Inline Keyboard Patterns:**

**Two-button layout:**
```
[âœ… Confirm] [âŒ Cancel]
```

**Three-button layout:**
```
[âœ… Yes] [â“ Info] [âŒ No]
```

**Menu navigation:**
```
[â† Back] [ğŸ  Home] [â†’ Next]
```

**Settings toggle:**
```
[ğŸ“Š Log: OFF â–¶ï¸ Enable]
[ğŸ“¸ Compress: ON â–¶ï¸ Disable]
```

### Notification Messages

**Success Notifications:**
```
âœ… [Action] Successful!
[Brief details]
[Optional: Next steps]
```

**Error Notifications:**
```
âŒ [Action] Failed
[Error details]
[Troubleshooting steps]
```

**Warning Notifications:**
```
âš ï¸ Warning: [Issue]
[Impact description]
[Recommended action]
```

**Info Notifications:**
```
â„¹ï¸ [Information Title]
[Details]
[Optional action]
```

---

## USER EXPERIENCE PRINCIPLES

### 1. Clarity & Simplicity
- Clear command structure dengan prefix /
- Inline buttons untuk pilihan biner
- Status messages yang informatif
- Progress indicators untuk proses lama
- Emoji sebagai visual cues

### 2. Feedback & Responsiveness
- Immediate acknowledgment untuk setiap input
- Real-time progress updates
- Clear success/error messages
- Estimated time untuk operasi lama

### 3. Error Prevention & Recovery
- Input validation sebelum processing
- Confirmation untuk destructive actions
- Auto-retry untuk network errors
- Manual retry option via /refresh
- Graceful degradation saat service unavailable

### 4. Security & Privacy
- Encrypted access keys
- Session timeout setelah inactivity
- Failed attempt lockout
- Master key sebagai emergency access
- No storage of sensitive data in logs

### 5. Flexibility & Control
- Batch mode untuk bulk operations
- Settings untuk customization
- Optional features (Log Dokumentasi)
- Command-based navigation
- Session management control

### Tone of Voice

**Bot Personality:**
- Professional & reliable
- Helpful & supportive
- Clear & concise
- Bahasa Indonesia formal tapi ramah

**Communication Style:**
- Instruksi step-by-step yang jelas
- Emoji untuk visual hierarchy
- Empati dalam error messages
- Celebratory untuk milestones

**Examples:**

âŒ Bad: "Error. Try again."
âœ… Good: "âŒ Upload gagal karena koneksi terputus. Silakan gunakan /refresh untuk mencoba lagi."

âŒ Bad: "Success"
âœ… Good: "âœ… 10 foto berhasil diupload! Total 24.5 MB tersimpan dengan aman di cloud."

---

## FUTURE ROADMAP

### Planned Features (v1.1 - v2.0)

1. **ğŸ“ Multi-Session Management**
   - User dapat akses multiple sessions simultaneously
   - Quick session switching
   - Session favorites
   - Recent sessions list

2. **ğŸ“Š Analytics Dashboard**
   - Total storage used per session
   - Upload history & statistics
   - Most active users
   - Storage trend charts
   - Export reports

3. **ğŸ” Search & Filter**
   - Search photos by description
   - Filter by date range
   - Filter by location (GPS)
   - Filter by user
   - Advanced search with metadata

4. **ğŸ—ºï¸ Map View**
   - Interactive map showing all photo locations
   - Cluster markers for multiple photos
   - Route visualization
   - Export GPS tracks
   - Integration with mapping apps

5. **ğŸ‘¥ Collaboration Features**
   - Multiple admins per session
   - User permissions (view-only, upload, full)
   - Comments on photos
   - Photo approval workflow
   - Activity feed

6. **ğŸ“± Mobile App Companion**
   - Native Android/iOS app
   - Offline mode with sync
   - Background upload
   - GPS tracking
   - Camera integration

7. **ğŸ”„ Integration Enhancements**
   - Dropbox integration
   - Google Drive direct upload
   - OneDrive support
   - Slack notifications
   - Email reports

8. **ğŸ¨ Photo Editing**
   - Basic filters
   - Crop & rotate
   - Watermark application
   - Batch editing
   - EXIF manipulation

9. **ğŸ“¦ Archive & Backup**
   - Auto-archive old sessions
   - Backup to multiple clouds
   - ZIP download for entire session
   - Scheduled backups
   - Restore from backup

10. **ğŸ¤– AI Features**
    - Auto-tagging dengan image recognition
    - Smart categorization
    - Duplicate detection
    - Quality assessment
    - Auto-description generation

### Improvements Planned

1. **Performance Optimization**
   - Parallel upload untuk multiple files
   - Upload resume untuk interrupted transfers
   - Compression options untuk save bandwidth
   - CDN integration untuk faster delivery
   - Caching mechanism

2. **Security Enhancements**
   - Two-factor authentication
   - IP whitelist
   - Session encryption
   - Audit logs
   - Regular security audits

3. **User Experience**
   - Voice command support
   - Multi-language interface
   - Dark mode
   - Customizable notifications
   - Keyboard shortcuts

4. **Admin Tools**
   - Bulk session creation
   - Session templates
   - User management dashboard
   - Storage quota management
   - Billing integration

5. **Integration & API**
   - Public API untuk developers
   - Webhook support
   - Zapier integration
   - IFTTT integration
   - Custom automation

---

## BATASAN & SCOPE

### Apa yang BISA Dilakukan (v1.0)

âœ… Create unlimited sessions dengan unique IDs
âœ… Role-based access control (ADMIN/USER)
âœ… Encrypted session access keys
âœ… Upload photos (JPG, JPEG, PNG) hingga 20 MB
âœ… Batch upload multiple photos
âœ… Real-time upload progress tracking
âœ… Extract EXIF metadata from photos
âœ… GPS coordinate extraction & reverse geocoding
âœ… Log metadata to Google Sheets
âœ… Backblaze B2 cloud storage integration
âœ… Error handling & auto-retry
âœ… Session status tracking
âœ… Master key emergency access
âœ… OAuth 2.0 Google authentication
âœ… Multi-user concurrent access

### Apa yang TIDAK BISA Dilakukan (v1.0)

âŒ Video upload (coming in v1.2)
âŒ Document files (PDF, DOCX, etc.)
âŒ Files larger than 20 MB
âŒ RAW image formats (CR2, NEF, ARW)
âŒ Offline mode
âŒ Background upload saat app closed
âŒ Photo editing capabilities
âŒ Automated backup scheduling
âŒ Map visualization
âŒ Web interface (Telegram only)
âŒ Real-time collaboration features
âŒ Voice commands
âŒ Multi-language interface (Indonesian only)

### Batasan Teknis

**Rate Limits:**
- Telegram Bot API: 30 messages/second
- Backblaze B2: 1000 API calls/day (free tier)
- Google Sheets API: 100 requests/100 seconds
- Reverse geocoding: 50 requests/minute

**Size Limits:**
- Photo file: 20 MB maximum
- Session description: 100 characters
- Access key attempts: 3 before lockout
- Concurrent uploads per user: 5 maximum
- Total sessions per user: Unlimited
- Photos per session: Unlimited

**Storage Limits:**
- Backblaze B2 free tier: 10 GB
- Database storage (Supabase): 500 MB free tier
- Google Drive: User's own quota

**Processing Time:**
- Upload time: Depends on file size & network
- Metadata extraction: < 2 seconds per photo
- Geocoding: < 3 seconds per coordinate
- Batch processing: ~5 seconds per photo
- Session creation: < 2 seconds

**Supported Platforms:**
- Telegram (iOS, Android, Web, Desktop)
- Google Sheets (requires Google account)
- Backblaze B2 (managed by bot)

---

## QUALITY ASSURANCE

### Testing Checklist

**Functional Testing:**
- [ ] Role detection (ADMIN vs USER) works correctly
- [ ] Session creation generates valid IDs and keys
- [ ] Access key validation accepts/rejects correctly
- [ ] Master key overrides work for ADMIN
- [ ] Photo upload completes successfully
- [ ] Batch mode accepts multiple photos
- [ ] EXIF extraction retrieves correct data
- [ ] GPS coordinates parse correctly
- [ ] Reverse geocoding returns valid addresses
- [ ] Google OAuth flow completes
- [ ] Google Sheets logging writes correctly
- [ ] /status shows accurate progress
- [ ] /end terminates session properly
- [ ] /refresh resolves errors
- [ ] Error messages display appropriately

**Edge Cases:**
- [ ] Photos without EXIF data
- [ ] Photos without GPS coordinates
- [ ] Very large photos (near 20 MB limit)
- [ ] Special characters in descriptions
- [ ] Same session ID prefix on same date
- [ ] Concurrent uploads from multiple users
- [ ] Network interruption during upload
- [ ] Google token expiration
- [ ] B2 bucket full
- [ ] Database connection lost
- [ ] Rapid command execution
- [ ] Session lockout after failed attempts

**User Experience:**
- [ ] Response time acceptable for all commands
- [ ] Progress indicators update smoothly
- [ ] Error messages helpful and actionable
- [ ] Success messages satisfying
- [ ] Button layouts intuitive
- [ ] Command structure logical
- [ ] Workflow feels natural
- [ ] No confusing states

**Security Testing:**
- [ ] Access keys properly encrypted
- [ ] Master key cannot be retrieved by USER
- [ ] Session lockout prevents brute force
- [ ] OAuth tokens stored securely
- [ ] No sensitive data in logs
- [ ] SQL injection prevention
- [ ] Input sanitization working
- [ ] Rate limiting prevents abuse

**Integration Testing:**
- [ ] Telegram API integration stable
- [ ] Backblaze B2 upload reliable
- [ ] Supabase queries perform well
- [ ] Google Sheets API writes succeed
- [ ] OAuth redirect works correctly
- [ ] Geocoding API responds accurately
- [ ] All external services handle errors

**Performance Testing:**
- [ ] Upload speed acceptable
- [ ] Database queries optimized
- [ ] Multiple concurrent users supported
- [ ] Batch uploads don't timeout
- [ ] Memory usage reasonable
- [ ] No memory leaks
- [ ] Response time under load

### Success Metrics

**Performance:**
- Session creation: < 2 seconds
- Photo upload (5MB): < 30 seconds
- Metadata extraction: < 2 seconds per photo
- Google Sheets write: < 5 seconds
- Command response: < 1 second
- Success rate: > 98%

**Quality:**
- Metadata accuracy: 100% (when EXIF present)
- Geocoding accuracy: > 95%
- Upload success rate: > 99%
- User satisfaction: > 4.5/5 stars
- Error recovery rate: > 90%

**Reliability:**
- Bot uptime: > 99.5%
- Database availability: > 99.9%
- Crash rate: < 0.1%
- Data loss: 0%
- Session corruption: 0%

**Security:**
- Unauthorized access: 0%
- Data breach incidents: 0%
- Failed key attempts locked: 100%
- Encrypted data storage: 100%

---

## SECURITY & PRIVACY

### Data Handling

1. **User Data:**
   - Minimal personal data collection
   - Only Telegram user ID and username stored
   - No phone numbers stored (except ADMIN contact)
   - Photos stored only in user's chosen cloud
   - Metadata extracted but not shared

2. **Access Keys:**
   - Generated using cryptographically secure random
   - Encrypted at rest in database (AES-256)
   - Never transmitted in plain text logs
   - Stored separately from session data
   - Master key encrypted with highest security

3. **Google OAuth:**
   - Tokens encrypted at rest
   - Limited scope (Sheets & Drive only)
   - Refresh tokens securely stored
   - Token expiry handled automatically
   - User can revoke access anytime

4. **Cloud Storage:**
   - Files stored in user's B2 bucket (isolated)
   - Bucket access restricted by API keys
   - File URLs not publicly guessable
   - Optional encryption at rest (B2 feature)

### Privacy Considerations

**Data Collection:**
- We collect: Telegram user ID, username, upload timestamps
- We don't collect: Phone numbers (except ADMIN), messages, personal info
- Photos processed: Not stored on bot server (temp only)
- Metadata: Only extracted, not analyzed
- Location data: Only from photo EXIF, not tracked

**Data Retention:**
- Session data: Retained until manual deletion
- Upload logs: Retained for 90 days
- Error logs: Retained for 30 days
- OAuth tokens: Retained while service active
- Temporary files: Deleted immediately after upload

**Third-Party Sharing:**
- No data shared with third parties
- Google: Only for OAuth & Sheets API (user authorized)
- Backblaze: Only for file storage (user's bucket)
- No analytics tracking
- No advertising integrations

**User Rights:**
- Right to access all stored data
- Right to delete session and all data
- Right to revoke Google access
- Right to export data
- Right to data portability

**Compliance:**
- GDPR considerations for EU users
- Data minimization principle
- Purpose limitation
- Storage limitation
- Security by design

### Security Best Practices

**Input Validation:**
- All user inputs sanitized
- File type validation before upload
- File size validation
- Session ID format validation
- SQL injection prevention
- XSS prevention in stored data

**Authentication & Authorization:**
- Role-based access control enforced
- Session timeout after 60 minutes inactivity
- Failed login attempts lockout (15 min)
- Master key access logged
- Admin actions audited

**Encryption:**
- Access keys: AES-256 encryption at rest
- Master key: AES-256 with separate key
- OAuth tokens: Encrypted at rest
- HTTPS for all API communications
- TLS 1.3 for Telegram webhook

**Logging & Monitoring:**
- All errors logged (without sensitive data)
- Admin actions logged
- Failed access attempts logged
- Unusual activity alerts
- No logging of access keys or passwords

**Infrastructure:**
- Regular security updates
- Dependency vulnerability scanning
- Database backups (daily)
- Disaster recovery plan
- Incident response procedures

**Penetration Testing:**
- Annual security audits
- Regular vulnerability assessments
- Bug bounty program (future)
- Third-party security review

---

## SUPPORT & MAINTENANCE

### User Support

**In-App Help:**

**Help Command (/help):**
```
â“ Telegram Documenter Help

ğŸ“š Available Commands:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
/start - Main menu
/status - Upload progress
/end - End session
/refresh - Refresh system
/settings - Session settings
/batch - Batch upload mode
/help - This help message

ğŸ“– Quick Guide:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Choose or create session
2. Enter access key
3. Send photos
4. Use /end when finished

ğŸ”— More Info:
docs.telegram-documenter.app

Need help? Contact: @support_bot
```

**Context-Sensitive Help:**
- Help buttons in error messages
- Tips during first-time use
- Examples in input prompts
- FAQ inline links

**Common Issues & Solutions:**

**Issue: "Cannot upload photos"**
```
ğŸ’¡ Troubleshooting:

1. Check if you're in active session
   â†’ Use /status to verify

2. Check file size (max 20 MB)
   â†’ Compress large photos

3. Refresh the system
   â†’ Use /refresh

4. Still not working?
   â†’ Contact support with error code
```

**Issue: "GPS data not found"**
```
ğŸ’¡ Solution:

Send photos as DOCUMENTS, not compressed images.

How to send as document:
1. Tap attachment (ğŸ“)
2. Select "File" or "Document"
3. Choose photo
4. Send

This preserves GPS metadata.
```

### Maintenance Plan

**Daily Tasks:**
- Monitor error logs
- Check upload success rates
- Verify all services online
- Review security alerts

**Weekly Tasks:**
- Database optimization
- Clear old temporary files
- Check API quota usage
- Review user feedback
- Update documentation

**Monthly Tasks:**
- Security audit
- Performance analysis
- Update dependencies
- Database backups verification
- Capacity planning

**Quarterly Tasks:**
- Feature prioritization review
- User survey
- Comprehensive testing
- Infrastructure review
- Disaster recovery drill

**Annual Tasks:**
- Major version update
- Security penetration testing
- Platform migration review
- Cost optimization
- Architecture review

### Update & Deployment

**Update Process:**
1. Test in development environment
2. Stage in production-like environment
3. User acceptance testing
4. Announce scheduled maintenance
5. Deploy during low-traffic hours
6. Monitor for issues
7. Rollback plan ready

**Rollback Procedure:**
- Keep previous version ready
- Database migration rollback scripts
- Automated rollback triggers
- Maximum 5-minute downtime target

**Version Notifications:**
```
ğŸ“¢ Update Available

Telegram Documenter v1.1.0

New Features:
âœ¨ Video upload support
âœ¨ Dark mode interface
ğŸ› Bug fixes and improvements

Update will be applied automatically.
Brief maintenance at 02:00 AM.
```

---

## DOKUMENTASI TAMBAHAN

### For Developers

**Technical Stack:**
- **Language:** Python 3.11+ or Node.js 18+
- **Framework:** python-telegram-bot or Telegraf.js
- **Database:** Supabase (PostgreSQL)
- **Cloud Storage:** Backblaze B2 SDK
- **OAuth:** google-auth-library
- **EXIF:** Pillow/exifread (Python) or exifr (Node.js)
- **Geocoding:** Google Maps API or Nominatim

**Project Structure:**
```
telegram-documenter/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ bot/
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ keyboards/
â”‚   â”‚   â””â”€â”€ middlewares/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ session.service.js
â”‚   â”‚   â”œâ”€â”€ upload.service.js
â”‚   â”‚   â”œâ”€â”€ metadata.service.js
â”‚   â”‚   â””â”€â”€ google.service.js
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”œâ”€â”€ utils/
â”‚   â””â”€â”€ config/
â”œâ”€â”€ tests/
â”œâ”€â”€ docs/
â”œâ”€â”€ .env.example
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

**Environment Variables:**
```
TELEGRAM_BOT_TOKEN=your_bot_token
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_anon_key
B2_APPLICATION_KEY_ID=your_b2_key_id
B2_APPLICATION_KEY=your_b2_key
B2_BUCKET_ID=your_bucket_id
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
MASTER_KEY_ENCRYPTION_KEY=your_master_encryption_key
GEOCODING_API_KEY=your_geocoding_api_key
```

**API Documentation:**
- REST endpoints for webhook
- Database schema documentation
- Integration guides
- Error code reference

**Development Guidelines:**
- Code style: ESLint/Prettier or Black/Flake8
- Git workflow: Feature branches + PR
- Commit convention: Conventional Commits
- Testing: Jest/Pytest with >80% coverage
- Documentation: JSDoc/Docstrings

### For Users

**Getting Started Guide:**

**Step 1: Start the Bot**
```
1. Open Telegram
2. Search for @telegram_documenter_bot
3. Send /start
4. Follow the welcome instructions
```

**Step 2: Create or Join Session (ADMIN)**
```
1. Click "Create New Session"
2. Save the access key sent to you
3. Enter session prefix (e.g., "DCM")
4. Add session description
5. Share key with team members
```

**Step 3: Join Session (USER)**
```
1. Get access key from admin
2. Click "Choose Existing Session"
3. Enter session ID
4. Enter access key
5. Start uploading photos
```

**Step 4: Upload Photos**
```
1. Send photos from gallery, or
2. Use Telegram camera
3. Check progress with /status
4. End session with /end
```

**Step 5: Enable Logging (Optional)**
```
1. Join a session first
2. Use /settings
3. Enable "Log Dokumentasi"
4. Authenticate with Google
5. Photos will auto-log to Sheets
```

**Tips & Tricks:**

ğŸ’¡ **For Better GPS Data:**
- Send photos as documents
- Enable location on camera
- Take photos with GPS active

ğŸ’¡ **For Faster Uploads:**
- Use WiFi connection
- Compress large photos
- Use batch mode for many photos

ğŸ’¡ **For Organization:**
- Use descriptive session names
- Consistent prefix naming
- Regular session reviews

**FAQ:**

**Q: Can I use this for free?**
A: Bot is free. You need your own Backblaze B2 account (10GB free).

**Q: Is my data safe?**
A: Yes. All access keys encrypted. Photos in your private cloud.

**Q: Can I access from multiple devices?**
A: Yes! Same Telegram account works everywhere.

**Q: What if I lose the access key?**
A: Contact admin. They can retrieve from database or use master key.

**Q: How to delete a session?**
A: Contact admin. Only they can delete sessions.

**Video Tutorials (Planned):**
- ğŸ“¹ Introduction to Telegram Documenter (3 min)
- ğŸ“¹ Creating Your First Session (5 min)
- ğŸ“¹ Uploading and Managing Photos (7 min)
- ğŸ“¹ Setting Up Log Dokumentasi (10 min)
- ğŸ“¹ Advanced Tips and Tricks (8 min)

---

## GLOSSARY

**Access Key:** Kode rahasia 9 karakter (ABC:DEF:GHI) untuk mengakses session tertentu.

**ADMIN:** User dengan hak penuh untuk membuat session, melihat access key, dan menggunakan master key.

**Backblaze B2:** Cloud storage service untuk menyimpan foto dan file.

**Batch Mode:** Mode upload yang memungkinkan mengirim beberapa foto sekaligus sebelum menambahkan deskripsi.

**EXIF Data:** Metadata yang tersimpan dalam file foto, termasuk tanggal, waktu, dan GPS.

**Geocoding:** Proses mengubah koordinat GPS menjadi alamat yang dapat dibaca manusia.

**Log Dokumentasi:** Fitur untuk mengekstrak dan menyimpan metadata foto ke Google Sheets.

**Master Key:** Kode rahasia 12 karakter milik ADMIN untuk membuka semua session (emergency access).

**Metadata:** Informasi tentang foto (tanggal, waktu, lokasi, dll) yang tidak terlihat di gambar.

**OAuth 2.0:** Protokol autentikasi aman untuk memberikan akses ke Google account tanpa sharing password.

**Prefix:** 2-3 huruf penanda di awal Session ID (contoh: DCM, ID, SRV).

**Reverse Geocoding:** Mengubah koordinat GPS menjadi alamat lengkap.

**Session:** Folder virtual di cloud storage untuk menyimpan foto-foto dalam satu kegiatan/proyek.

**Session ID:** Identifier unik untuk session dengan format PREFIX-MMDD-NN-Description.

**Supabase:** Platform database (PostgreSQL) untuk menyimpan data aplikasi.

**USER:** Pengguna regular yang dapat mengakses session dengan access key, tapi tidak bisa membuatnya.

---

## VERSION HISTORY

**v1.0.0 (Current - Development)**
- Initial release
- Session management system
- Role-based access control (ADMIN/USER)
- Access key encryption
- Photo upload to Backblaze B2
- Metadata extraction (EXIF)
- Google Sheets integration
- Batch upload mode
- Progress tracking
- Error handling & retry

**Planned Versions:**

**v1.1.0 (Q2 2024)**
- Video upload support
- Dark mode interface
- Performance optimization
- Upload resume capability
- Enhanced error messages

**v1.2.0 (Q3 2024)**
- Multi-session switching
- Session favorites
- Search functionality
- Basic analytics dashboard
- Email notifications

**v2.0.0 (Q4 2024)**
- Map visualization
- Collaboration features
- Web interface
- Mobile app (Android/iOS)
- Advanced admin tools

**v2.1.0 (Q1 2025)**
- AI auto-tagging
- Smart categorization
- Multi-cloud support
- API for developers
- Advanced integrations

---

## CONTACT & SUPPORT

**Development Team:**
- Lead Developer: [TBD]
- Backend Engineer: [TBD]
- Security Engineer: [TBD]
- UI/UX Designer: [TBD]

**Support Channels:**
- Telegram Support: @telegram_documenter_support
- Email: support@telegram-documenter.app
- Documentation: docs.telegram-documenter.app
- GitHub: github.com/telegram-documenter
- Community: t.me/telegram_documenter_community

**Business Inquiries:**
- Email: business@telegram-documenter.app
- Partnership: partners@telegram-documenter.app

**Security Issues:**
- Security Email: security@telegram-documenter.app
- PGP Key: [Available on website]
- Responsible Disclosure Policy: Available on website

**Social Media:**
- Twitter: @tg_documenter
- Instagram: @telegram.documenter
- LinkedIn: Telegram Documenter

---

**Document Version:** 1.0  
**Last Updated:** February 4, 2026  
**Status:** Development Phase  
**Next Review:** March 1, 2026  
**Author:** [Your Name/Team]  
**Approved By:** [TBD]

---

**END OF PROJECT CONTEXT**
